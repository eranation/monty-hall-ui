<!doctype html>
<html lang="en-US" class="loading">
<head>
	<meta charset="utf-8">
	<!-- From HTML 5 Boilerplate: Use .htaccess instead. See: h5bp.com/i/378 -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>instructions view</title>

	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">

	<style type="text/css">html.loading { opacity: 0; }</style>

</head>
<body class="container">
	<button onclick="setGameState('awaiting-initial-selection')">awaiting initial selection</button>
	<button onclick="setGameState('awaiting-final-selection')">awaiting final selection</button>
	<button onclick="setGameState('won')">won</button>
	<button onclick="setGameState('lost')">lost</button>
	<div class="instructions"></div>
</body>
<script>

var curl;

function start () {
	var cbName;
	try {
		// find callback on parent window
		cbName = document.location.hash.substr(1);
		if (!cbName) throw new Error('callback not found in url.');
		if (!window.parent) throw new Error('no parent window found.');
		if (!window.parent[cbName]) throw new Error('no callback found.');
		window.parent[cbName](function () {
			curl(['wire'], inContext(runTests));
		});
	}
	catch (ex) {
		console.error(ex);
		throw ex;
	}
}

start();

// capture current window since some of the following
// code could execute in parent!
var win = window;

function inContext (func) {
	return function () {
		var ctx = this, args = arguments;
		win.setTimeout(function () {
			func.apply(ctx, args);
		}, 0);
	};
}

function runTests (wire) {

	// TODO: also put unit and/or functional tests here

	wire({
		gameView: document.body,
		instructionsView: {
			render: {
				template: { module: 'text!app/instructions/template.html' },
				replace: { module: 'i18n!app/instructions/strings' },
				css: { module: 'css!app/instructions/structure.css' },
				at: { $ref: 'dom.first!.instructions', at: 'gameView' }
			}
		},
		css: [
			{ module: 'css!theme/base.css' }
		],
		plugins: [
			{ module: 'wire/debug' },
			{ module: 'wire/dom', classes: { init: 'loading' } },
			{ module: 'wire/dom/render' }
		]
	}).then(function (context) {
		document.body.appendChild(context.gameView);
	});

}


function setGameState (state) {
	document.body.className = state + ' container';
}

</script>
</html>