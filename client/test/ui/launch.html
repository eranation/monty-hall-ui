<!doctype html>
<html lang="en-US" class="loading">
<head>
	<meta charset="utf-8">
	<!-- From HTML 5 Boilerplate: Use .htaccess instead. See: h5bp.com/i/378 -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>harness launcher</title>

	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">

	<style>
		/* good enough for demo */
		iframe {
			width: 100%;
			height: 720px;
		}
	</style>
</head>
<body>
</body>
<script>
(function (global) {
	var curlUrl, commonCfg, callbackKey;

	curlUrl = '../../../lib/curl/src/curl.js';
	callbackKey = 'harnessCallback';
	commonCfg = {
		baseUrl: '../../../',
		packages: [
			{ name: 'curl', location: 'lib/curl/src/curl', main: '../curl' },
			{ name: 'wire', location: 'lib/wire', main: './wire' },
			{ name: 'when', location: 'lib/when', main: './when' },
			{ name: 'rest', location: 'lib/rest', main: './rest' },
			{ name: 'meld', location: 'lib/meld', main: './meld' },
			{ name: 'poly', location: 'lib/poly', main: './poly' },
			{ name: 'cola', location: 'lib/cola', main: './cola' },
			{ name: 'integration', location: 'lib/integration', main: 'integration' },
			{ name: 'clicks', location: 'lib/clicks', main: 'clicks' }
		]
	};

	loadHarness(getHarnessUrl(), document.body);

	function loadCurl (harness, cb) {
		var doc, script;

		doc = harness.document;
		script = doc.createElement('script');
		script.onload = cb;
		script.onerror = function () {
			console.log('could not load curl!');
		};
		script.src = curlUrl;
		(doc.head || doc.getElementsByTagName('head')[0]).appendChild(script);
	}

	// load harness in test frame
	function loadHarness (url, node) {
		var iframe, harness, curl;

		// create temporary global callback
		global[callbackKey] = function (cb) {

			harness = iframe.contentWindow;
			document.title = 'harness: '  + harness.document.title;
			loadCurl(harness, function () {
				delete global[callbackKey];
				curl = harness.curl;
				curl(commonCfg);
				cb();
			});
		};

		iframe = node.ownerDocument.createElement('iframe');

		node.appendChild(iframe);

		iframe.src = url;
	}

	function getHarnessUrl () {
		var hUrl;
		hUrl = document.location.hash.substr(1);
		return hUrl + '#' + callbackKey;
	}

}(window));

</script>
</html>